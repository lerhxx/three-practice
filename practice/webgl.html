<!DOCTYPE html>
<html>
<head>
	<title>webgl practice</title>
</head>
<body>
	<canvas id='canvas'></canvas>
	<script id='vertex' type='notjs'>
		attribute vec4 a_position;
		void main() {
			gl_Position = a_position;
		}
	</script>
	<script id='fragment' type="notjs">
		precision mediump float;
		void main() {
			gl_FragColor = vec4(1, 0, 0.5, 1);
		}
	</script>
	<script>
		window.onload = function() {
			function init() {
				var canvas = document.getElementById('canvas'),
					ctx;
				if(!canvas) {
					console.log('no element');
					return;
				}
				gl = canvas.getContext('webgl');
				if(!gl) {
					console.log('no webgl for you');
					return;
				}

				canvas.width = 400;
				canvas.height = 300;

				var vertexSource = document.getElementById('vertex').text,
					fragmentSource = document.getElementById('fragment').text;

				var vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexSource),
					fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentSource);

				var program = createProgram(gl, vertexShader, fragmentShader);

				var positionLocation = gl.getAttribLocation(program, 'a_position');

				var position = [
					0, 0,
					0, .5,
					.7, 0
				]

				var buffer = gl.createBuffer();
				gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
				gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(position), gl.STATIC_DRAW);

				gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
				gl.clearColor(0, 0, 0, 0);
				gl.clear(gl.COLOR_BUFFER_BIT);

				gl.useProgram(program);

				gl.enableVertexAttribArray(positionLocation);

				gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

				gl.drawArrays(gl.TRIANGLES, 0, 3);
			}

			function createShader(gl, type, source) {
				var shader = gl.createShader(type);
				gl.shaderSource(shader, source);
				gl.compileShader(shader);
				var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
				if(success) {
					return shader;
				}
				console.log(gl.getShaderInfoLog(shader));
				gl.deleteShader(shader);
			}

			function createProgram(gl, vertex, fragment) {
				var program = gl.createProgram();

				gl.attachShader(program, vertex);
				gl.attachShader(program, fragment);
				gl.linkProgram(program);

				var success = gl.getProgramParameter(program, gl.LINK_STATUS);
				if(success) {
					return program;
				}
				console.log(gl.getProgramInfoLog(program));
				gl.deleteProgram(program);
			}

			init();
		}
	</script>
</body>
</html>